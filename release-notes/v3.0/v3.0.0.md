# Release Notes - v3.0.0

**Release Date**: 2026-01-06
**Type**: Major Release - Breaking Changes
**Commit**: Multiple commits (major rebase)

---

## Breaking Changes

### Module System Rebase

1. **Module count reduced from 9 to 8**
   - Dreams module removed as standalone
   - Dreams functionality integrated into Vision module as Step 4

2. **Linear progression enforced (순차적 강제)**
   - All previous modules MUST be completed before starting next
   - No module skipping allowed (unlike previous flexible system)

3. **Database schema changes**
   - `module_progress.module_id` constraint updated (8 modules only)
   - New `user_integrated_profiles` table for cross-module data
   - `vision_statements` table extended with dreams columns

---

## New Features

### Linear Module Progression

```typescript
// New module order (8 modules)
export const MODULE_ORDER: ModuleId[] = [
  'values',      // Part 1: Self-Discovery
  'strengths',   // Part 1: Self-Discovery
  'enneagram',   // Part 1: Self-Discovery
  'life-themes', // Part 1: Self-Discovery
  'vision',      // Part 2: Vision & Mission (includes Dreams)
  'swot',        // Part 3: Strategic Analysis
  'goals',       // Part 4: Goal Setting
  'errc',        // Part 4: Goal Setting
];

// Linear progression check
export function canStartModuleLinear(
  moduleId: ModuleId,
  completedModules: Set<ModuleId>
): { canStart: boolean; missingPrerequisites: ModuleId[] }
```

### Dreams → Vision Integration

- Dreams Matrix now appears as Vision Step 4
- 7 Wellbeing Dimensions tracking:
  - Physical, Emotional, Intellectual, Social
  - Spiritual, Occupational, Economic
- Life stage categorization: Immediate, 1-3 years, 5 years, 10+ years

### Cross-Module Data Integration

New `ModuleProgressService` methods:
- `getCrossModuleContext()` - Get all completed module data
- `getPrerequisiteData()` - Get prerequisite module data for AI context
- `syncIntegratedProfile()` - Sync user profile when module completes
- `generatePromptContext()` - Generate AI prompt context from user data

### Integrated User Profile

New `user_integrated_profiles` table aggregates:
- Top values (terminal, instrumental, work)
- Top strengths with evidence
- Enneagram type, wing, instinct
- Life themes
- Vision statement and core aspirations
- Dreams by life stage and wellbeing
- SWOT summary and priority strategies
- Life roles and objectives
- ERRC actions
- AI-generated insights

---

## Database Migrations

### Required Migrations (apply in order)

1. `2026-01-06-update-module-progress-for-rebase.sql`
   - Updates module_id constraint to 8 modules
   - Creates journey status functions

2. `2026-01-06-create-user-integrated-profiles.sql`
   - Creates new profile aggregation table
   - Sets up RLS policies

3. `2026-01-06-update-vision-for-dreams.sql`
   - Adds dreams columns to vision_statements
   - JSONB columns for dreams data

4. `2026-01-06-migrate-dreams-to-vision.sql`
   - Migrates existing dreams data to vision table
   - Run after previous migrations

---

## Type System Changes

### ModuleId Type

```typescript
// Before (v2.x)
export type ModuleId =
  | 'values' | 'strengths' | 'enneagram' | 'life-themes'
  | 'vision' | 'dreams' | 'swot' | 'goals' | 'errc';

// After (v3.0)
export type ModuleId =
  | 'values' | 'strengths' | 'enneagram' | 'life-themes'
  | 'vision' | 'swot' | 'goals' | 'errc';
```

### New Types

- `ModulePart` - Module groupings
- `IntegratedProfile` - User profile interface
- `CrossModuleContext` - Cross-module data context

---

## UI/UX Changes

### Journey Progress Map

New `JourneyProgressMap` component shows:
- 8-module linear progression visualization
- 4-part journey overview
- Locked/unlocked module states
- Completion percentages

### Completed Modules Summary

New `CompletedModulesSummary` component:
- Expandable view of completed modules
- Quick access to review past work

---

## API Changes

### New Endpoints

- `GET /api/modules/progress` - Returns `isAdmin` flag
- `GET /api/modules/integrated-profile` - User profile data
- `POST /api/modules/integrated-profile` - Refresh profile
- `GET /api/modules/context` - Cross-module context

### Modified Endpoints

All module session APIs now enforce linear progression check.

---

## Migration Guide

### From v2.x to v3.0

1. **Apply database migrations** (in order)
2. **Clear browser cache** for updated frontend
3. **Existing users**: Dreams data auto-migrates to Vision
4. **Module progress**: Users may need to complete skipped modules

### Breaking Change Handling

- Users who skipped modules must complete them in order
- Dreams module redirects to Vision Step 4
- Old dreams URLs redirect automatically

---

## Files Modified

**Core Files:**
- `src/lib/types/modules.ts` - Type definitions
- `src/lib/services/moduleProgressService.ts` - Progress service
- `src/app/api/modules/progress/route.ts` - Progress API
- `src/app/discover/vision/step4-dreams/page.tsx` - Dreams in Vision

**Database:**
- 4 new migration files in `database/migrations/`

---

**Full Plan**: See [docs/plans/2026-01-06_rebase-plan-v3.0.md](../../docs/plans/2026-01-06_rebase-plan-v3.0.md)
