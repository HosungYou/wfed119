# Release Notes - v3.1.0

**Release Date**: 2026-01-06
**Type**: Feature Release - Phase 2 Enhancements
**Commit**: `448a879` (admin bypass), previous commits for Phase 2

---

## Summary

Phase 2 implementation completing the LifeCraft Bot enhancement plan:
- AI endpoint fixes across all 13 API routes
- Unified module components (ModuleShell, ModuleHeader, ActivitySidebar)
- New Mission Statement module (4 steps)
- New Career Options module (4 steps with Holland Code assessment)
- SWOT AI auto-fill endpoint
- Admin bypass for module locks

---

## New Features

### 1. Mission Statement Module

**Path**: `/discover/mission/`

4-step workflow for crafting personal mission statements:

| Step | Name | Description |
|------|------|-------------|
| 1 | Values Review | Review top values from Values module |
| 2 | Purpose Questions | AI-guided life purpose reflection |
| 3 | Mission Draft | AI-assisted mission drafting |
| 4 | Mission Refinement | Edit and finalize statement |

**Database**: `mission_statements` table
```sql
CREATE TABLE public.mission_statements (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  values_used JSONB,
  purpose_answers JSONB,
  draft_versions JSONB,
  final_statement TEXT,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

### 2. Career Options Module

**Path**: `/discover/career-options/`

4-step career exploration with Holland Code assessment:

| Step | Name | Description |
|------|------|-------------|
| 1 | Holland Assessment | 30-question RIASEC inventory |
| 2 | AI Career Suggestions | AI generates career recommendations |
| 3 | Career Research | Deep dive into selected careers |
| 4 | Career Comparison | Side-by-side comparison matrix |

**Holland Code Types**: R (Realistic), I (Investigative), A (Artistic), S (Social), E (Enterprising), C (Conventional)

**Database**: `career_explorations` table
```sql
CREATE TABLE public.career_explorations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  holland_code VARCHAR(6),
  holland_scores JSONB,
  holland_responses JSONB,
  suggested_careers JSONB,
  explored_careers JSONB,
  comparison_matrix JSONB,
  current_step INTEGER DEFAULT 1,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

### 3. Admin Module Lock Bypass

ADMIN and SUPER_ADMIN users can now access all modules without lock restrictions.

**Implementation**:
```typescript
// moduleProgressService.ts
async checkIsAdmin(): Promise<boolean> {
  const { data } = await supabase
    .from('users')
    .select('role')
    .eq('id', this.userId)
    .single();

  return data?.role === 'ADMIN' || data?.role === 'SUPER_ADMIN';
}
```

**Affected Methods**:
- `canStartModule()` - Returns `canStart: true` for admins
- `getJourneyStatus()` - Returns `isLocked: false` for admins

**API Response**:
```json
{
  "modules": { ... },
  "isAdmin": true
}
```

### 4. SWOT AI Auto-fill

**Endpoint**: `POST /api/discover/swot/ai-suggest`

Pre-populates SWOT analysis using data from completed modules:
- Strengths from Strengths module
- Values-based opportunities
- Enneagram-based weaknesses/threats

---

## Unified Module Components

### ModuleShell

Consistent layout wrapper for all module pages:
```tsx
<ModuleShell
  moduleId="values"
  currentStep={1}
  totalSteps={5}
  title="Values Discovery"
  sidebar={<ActivitySidebar activities={activities} />}
>
  {children}
</ModuleShell>
```

### ModuleHeader

Navigation header with:
- Home button (always visible)
- Module title with i18n support
- Step progress indicator
- Breadcrumb navigation

### ActivitySidebar

Step tracking sidebar:
- Clickable step list
- Status indicators (locked, available, in-progress, completed)
- Progress summary
- Collapsible on mobile

### ModuleCard & ModuleButton

Consistent UI components:
```tsx
<ModuleCard padding="normal" className="...">
  <h2>Card Title</h2>
  <p>Card content</p>
</ModuleCard>

<ModuleButton variant="primary" size="medium">
  Continue
</ModuleButton>
```

---

## AI Endpoint Fixes

### Fixed Model Names

All endpoints updated to use correct Claude model name:
```typescript
// Before (error)
model: 'claude-3.5-sonnet'

// After (correct)
model: 'claude-3-5-sonnet-20241022'
```

### API Key Validation

All AI endpoints now validate API key before calling:
```typescript
const apiKey = process.env.ANTHROPIC_API_KEY;
if (!apiKey || apiKey === 'your_anthropic_api_key_here' || apiKey.length < 10) {
  return NextResponse.json({
    suggestions: generateFallbackData(),
    source: 'fallback',
    message: 'AI service not configured'
  });
}
```

### Endpoints Fixed (13 total)

1. `/api/discover/vision/ai-suggest/route.ts`
2. `/api/discover/vision/ai-coach/route.ts`
3. `/api/discover/vision/dreams/ai-analyze/route.ts`
4. `/api/discover/swot/ai-suggest/route.ts`
5. `/api/discover/swot/auto-fill/route.ts`
6. `/api/discover/goals/ai-suggest/route.ts`
7. `/api/discover/mission/ai-coach/route.ts`
8. `/api/discover/career-options/ai-suggest/route.ts`
9. `/api/discover/enneagram/ai-analyze/route.ts`
10. `/api/discover/strengths/chat/route.ts`
11. `/api/discover/life-themes/ai-analyze/route.ts`
12. `/api/discover/errc/ai-suggest/route.ts`
13. `/api/discover/values/ai-analyze/route.ts`

---

## Database Migrations

New migrations for v3.1:

1. `2026-01-06-create-mission-statements.sql`
2. `2026-01-06-create-career-explorations.sql`

---

## Files Modified

**New Files (32)**:
- `src/components/modules/ModuleShell.tsx`
- `src/components/modules/ModuleHeader.tsx`
- `src/components/modules/ActivitySidebar.tsx`
- `src/components/modules/ModuleCard.tsx`
- `src/components/modules/ModuleButton.tsx`
- `src/components/modules/index.ts`
- `src/app/discover/mission/page.tsx`
- `src/app/discover/mission/step1/page.tsx`
- `src/app/discover/mission/step2/page.tsx`
- `src/app/discover/mission/step3/page.tsx`
- `src/app/discover/mission/step4/page.tsx`
- `src/app/api/discover/mission/session/route.ts`
- `src/app/api/discover/mission/ai-coach/route.ts`
- `src/app/discover/career-options/page.tsx`
- `src/app/discover/career-options/step1/page.tsx`
- `src/app/discover/career-options/step2/page.tsx`
- `src/app/discover/career-options/step3/page.tsx`
- `src/app/discover/career-options/step4/page.tsx`
- `src/app/api/discover/career-options/session/route.ts`
- `src/app/api/discover/career-options/ai-suggest/route.ts`
- `src/app/api/discover/swot/auto-fill/route.ts`
- `database/migrations/2026-01-06-create-mission-statements.sql`
- `database/migrations/2026-01-06-create-career-explorations.sql`

**Modified Files (15)**:
- `src/lib/types/modules.ts` - Added mission/career-options types
- `src/lib/services/moduleProgressService.ts` - Admin bypass
- `src/app/api/modules/progress/route.ts` - isAdmin flag
- 13 AI endpoint files - Model name and validation fixes

---

## Upgrade Notes

### From v3.0 to v3.1

1. **Apply new migrations**:
   ```bash
   # In Supabase SQL Editor
   -- Run create-mission-statements.sql
   -- Run create-career-explorations.sql
   ```

2. **Set ANTHROPIC_API_KEY** (if not already set):
   ```bash
   ANTHROPIC_API_KEY=sk-ant-api03-...
   ```

3. **Admin users**: Verify role is set in `users` table
   ```sql
   UPDATE public.users SET role = 'ADMIN' WHERE email = 'admin@example.com';
   ```

### Breaking Changes

None - fully backward compatible with v3.0

---

## Known Issues

- ModuleShell not yet applied to all existing modules (pending)
- Mission and Career Options modules not in linear progression (optional modules)

---

**GitHub Release**: [v3.1.0](https://github.com/HosungYou/wfed119/releases/tag/v3.1.0)
