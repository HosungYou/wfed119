# v3.2.1 Release Notes

> **Commit**: (to be generated)
> **Type**: Feature Enhancement + Bug Fix
> **Files Modified**: 7 files
> **Date**: 2026-01-08

---

## ğŸš€ Major Features

### 1. **Career Options Step 2: Resume AI Review**

**Implementation**: Complete replacement of Career Research step with AI-powered Resume Analysis.

**Core Technical Changes**:

#### Resume Upload UI (`src/app/discover/career-options/step2/page.tsx`)

```typescript
// Drag-and-drop + file picker implementation
interface ResumeAnalysis {
  professionalSummary: string;
  professionalSummaryKo: string;
  keyCompetencies: string[];
  keyCompetenciesKo: string[];
  experienceLevel: string;
  suggestedCareers: ONetCareer[];
  overallFit: number;
}

interface ONetCareer {
  onetCode: string;  // Format: XX-XXXX.XX (e.g., "11-3121.00")
  title: string;
  titleKo: string;
  description: string;
  descriptionKo: string;
  fitScore: number;
  keySkillsMatch: string[];
  salaryRange: string;
  growthOutlook: string;
  link: string;  // https://www.onetonline.org/link/summary/{code}
}
```

**UI Implementation**:
- **Drag-and-Drop Zone**: HTML5 File API with dragenter/dragover/drop handlers
- **Supported Formats**: PDF, .docx, .txt (explicitly documented)
- **File Validation**: Size limit checks, format verification
- **Progress Indicator**: Upload and analysis status with loader animation
- **Results Display**: O*NET career cards with fit scores, links, and bilingual descriptions

#### Resume Analysis API (`src/app/api/discover/career-options/analyze-resume/route.ts`)

```typescript
// File parsing strategy
if (fileType === 'application/pdf' || fileName.endsWith('.pdf')) {
  // PDF: Send directly to Claude as base64 document
  isPdf = true;
  pdfBase64 = buffer.toString('base64');
} else if (fileName.endsWith('.docx')) {
  // DOCX: Parse with mammoth library
  const result = await mammoth.extractRawText({ buffer });
  resumeContent = result.value;
} else if (fileName.endsWith('.txt')) {
  // TXT: Direct UTF-8 read
  resumeContent = buffer.toString('utf-8');
}
```

**AI Integration**:
- **Framework**: Dr. Padilla's Workforce-Market Alignment Framework
- **Model**: `claude-sonnet-4-20250514`
- **Output**: JSON with O*NET codes and bilingual career suggestions
- **Fallback**: Holland Code-based suggestions when AI unavailable

### 2. **O*NET Database Integration**

**Link Format**: `https://www.onetonline.org/link/summary/{onetCode}`

```typescript
// Auto-generated valid O*NET links
analysis.suggestedCareers = analysis.suggestedCareers.map((career: any) => ({
  ...career,
  link: `https://www.onetonline.org/link/summary/${career.onetCode}`,
}));
```

---

## ğŸ› Critical Bug Fixes

### 1. **Old .doc Format Not Supported Error**

**Error**: `400 Bad Request` when uploading `.doc` files

**Root Cause**: `mammoth` library only supports `.docx` format, not legacy `.doc` format.

**Fix Mechanism**:

```typescript
// Before (missing .doc handling - caused 400 error)
// No explicit check for .doc files

// After (explicit error message with guidance)
} else if (fileType === 'application/msword' || fileName.endsWith('.doc')) {
  return NextResponse.json({
    error: 'Old .doc format is not supported. Please save your resume as .docx or PDF format and try again.',
    errorKo: 'êµ¬í˜• .doc í˜•ì‹ì€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë ¥ì„œë¥¼ .docx ë˜ëŠ” PDF í˜•ì‹ìœ¼ë¡œ ì €ì¥ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
  }, { status: 400 });
}
```

**Impact**: Clear bilingual error message guides users to convert `.doc` to `.docx` or PDF.

---

## ğŸ› ï¸ Technical Implementation Details

### New Dependencies

```json
// package.json
"mammoth": "^1.9.0"  // Word document (.docx) parsing
```

### Modified Files

| File | Changes |
|------|---------|
| `src/app/discover/career-options/step2/page.tsx` | Complete rewrite: Resume upload UI |
| `src/app/api/discover/career-options/analyze-resume/route.ts` | New: AI resume analysis endpoint |
| `src/app/api/discover/career-options/session/route.ts` | Added: resume_analysis, selected_onet_careers fields |
| `src/app/discover/career-options/step3/page.tsx` | Updated: Combines Holland + Resume analysis |
| `src/app/discover/career-options/step1/page.tsx` | Updated: STEPS constant |
| `src/app/discover/career-options/step4/page.tsx` | Updated: STEPS constant |

### STEPS Flow Update

```typescript
// All Career Options step pages now use:
const STEPS = [
  { id: 'step1', label: 'Holland Assessment', labelKo: 'Holland ì ì„± ê²€ì‚¬' },
  { id: 'step2', label: 'Resume AI Review', labelKo: 'ì´ë ¥ì„œ AI ë¶„ì„' },
  { id: 'step3', label: 'AI Career Suggestions', labelKo: 'AI ê²½ë ¥ ì¶”ì²œ' },
  { id: 'step4', label: 'Career Comparison', labelKo: 'ê²½ë ¥ ë¹„êµ' },
];
```

---

## ğŸ“Š Data Structure Changes

### Career Exploration Session Schema Update

```typescript
// New fields in career_explorations table (JSONB)
{
  resume_analysis: {
    professionalSummary: string;
    professionalSummaryKo: string;
    keyCompetencies: string[];
    keyCompetenciesKo: string[];
    experienceLevel: string;
    suggestedCareers: ONetCareer[];
    overallFit: number;
  };
  selected_onet_careers: ONetCareer[];  // User's selected careers from suggestions
}
```

---

## ğŸ”§ Deployment Verification

### Build Success Indicators
- âœ… TypeScript compilation: No errors
- âœ… Next.js build: Successful
- âœ… mammoth dependency: Installed and functional
- âœ… PDF parsing: Claude native document support working
- âœ… DOCX parsing: mammoth extractRawText working
- âœ… .doc error handling: Proper 400 response with bilingual message

---

## ğŸ“‹ Technical Summary

**Files Modified**: 7 files
- `src/app/discover/career-options/step1/page.tsx` - STEPS constant update
- `src/app/discover/career-options/step2/page.tsx` - Complete rewrite for resume upload
- `src/app/discover/career-options/step3/page.tsx` - Holland + Resume integration
- `src/app/discover/career-options/step4/page.tsx` - STEPS constant update
- `src/app/api/discover/career-options/analyze-resume/route.ts` - New API endpoint
- `src/app/api/discover/career-options/session/route.ts` - Schema extension
- `package.json` - mammoth dependency

**Algorithmic Achievement**: Dr. Padilla's Workforce-Market Alignment Framework integration with O*NET database for AI-powered career matching based on resume + Holland Assessment combination.

**Next Release**: v3.2.2 - Dashboard bilingual support and profile page fixes
