# Release v3.5.0 - Mission Module Redesign

**Release Date**: 2026-02-17
**Type**: Major Feature Redesign
**Commit**: `e05773f`
**Files Modified**: 17 files (modified/rewritten)
**Files Deleted**: 4 files
**Files Created**: 2 files
**Net Change**: +5,379 / -2,617 lines
**Status**: Production Deployed

---

## Overview

Complete redesign of **Module #4: Mission Statement** from an AI-generates-everything approach to a student-assembles-components (bottom-up) approach based on Part B of the PDF worksheet "Assignment 4: Exploring Values and Crafting a Mission Statement."

Students now select contribution targets and action verbs from grids, then iteratively build their mission statement through 3 drafting rounds. AI serves 7 distinct scaffolding roles but never writes the final statement for the student.

---

## Step Flow Change: 5 Steps → 4 Steps

| Old Step | New Step | Content | Change |
|----------|----------|---------|--------|
| Step 1 (Values Review) | **Step 1** | Values Summary + Top 3 Mission Values | Modified: added top3 selection + AI Values Connector |
| Step 2 (Life Roles) | **Step 2** | Mission Components (Targets + Verbs) | **Full rewrite**: chip-selection grids |
| Step 3 (Role Reflection) | **Step 3** | Mission Drafting (3 Rounds) | **Full rewrite**: template → sentence → polish |
| Step 4 (Roles & Commitment) | **Step 4** | Reflection | **Full rewrite**: 3 reflection questions |
| Step 5 (Mission Statement) | **Deleted** | ~~AI Mission Draft~~ | Absorbed into Step 3 |

---

## New Features

### Step 1: Values Summary + Top 3 Mission Values

**Implementation**: Existing values display + new `top3MissionValues` selection

- Terminal, Instrumental, Work values displayed in 3 category cards (read-only from Values module)
- Student selects top 3 values most directly connected to their mission
- AI Values Connector generates a values profile summary linking across categories

```typescript
// New fields saved
top3_mission_values: string[]   // 3 most mission-relevant values
ai_insights.values_insight: string  // AI-generated values profile
```

### Step 2: Mission Components (Contribution Targets + Action Verbs)

**Implementation**: Two chip-selection grids on a single page

**Section A — Contribution Targets** (~96 words):
- 4-column grid of selectable chips (Education, Diversity, Climate Change, Mental Health, etc.)
- Search/filter input for quick lookup
- AI recommends 5-8 targets based on values + enneagram + life themes (purple "AI" badge)
- Custom input: 2 slots for student-added targets
- Selection range: 3-5 targets

**Section B — Action Verbs** (~97 words):
- Same chip-selection pattern (Achieve, Advocate, Build, Create, Empower, etc.)
- AI recommends 5-8 verbs based on instrumental values + enneagram
- Custom input: 2 slots
- Selection range: 3-5 verbs

```typescript
// New API endpoint
POST /api/discover/mission/ai-components
// Returns: { targets: string[], verbs: string[], reasoning: string }
```

### Step 3: Mission Drafting — 3-Round Process

**Implementation**: Sequential accordion/stepper with round-by-round progression

**Round 1 — Basic Structure**:
- AI auto-fills two template options from selected components:
  - Option 1: `My mission is to [verbs] for/in [targets] guided by [values]`
  - Option 2: `My mission is to [verbs] to/for [targets+values combined]`
- Student picks option 1, option 2, or freewrite
- All three options are editable textareas

**Round 2 — Complete Sentence**:
- Round 1 result displayed as reference
- Student rewrites into natural flowing sentence
- "AI Suggestion" button generates a refined version
- Side-by-side comparison: student version vs AI version
- Student keeps theirs, adopts AI's, or mixes both

**Round 3 — Final Polish**:
- 4-criteria self-assessment checklist:
  - Clear (understandable by a 10-year-old)
  - Inspiring (gives energy)
  - Altruistic (earns others' support)
  - Concise (memorizable)
- "AI Analyze" button: scores each criterion 1-10, provides specific improvement suggestions
- "AI Polish" button: generates optimized version based on 4 criteria
- Final mission statement textarea (the core deliverable)

```typescript
// AI roles used in Step 3
type: 'mission_composer'   // Round 1: auto-fills templates
type: 'sentence_refiner'   // Round 2: refines into natural sentence
type: 'mission_analyst'    // Round 3: 4-criteria scoring
type: 'polish_suggest'     // Round 3: polish based on criteria
```

### Step 4: Reflection

**Implementation**: 3 reflection questions from Part C of the PDF worksheet

1. "How does your mission statement inspire you? How will it guide future actions?" (200+ words)
2. "How can acting in alignment lead to a meaningful life and career?" (200+ words)
3. "How was this activity? Feedback for improvement." (100+ words)

- Word count indicators with green highlight when minimum met
- On completion: `completeModule()` called, AI Reflection Guide generates 2-3 personalized follow-up insights
- Completion screen: mission statement card, AI insights, copy button, navigation

---

## 7 AI Roles

| # | Role | Step | Trigger | Function |
|---|------|------|---------|----------|
| 1 | Values Connector | Step 1 | Auto after selection | Values profile summary |
| 2 | Target Recommender | Step 2A | Auto on page load | Highlight 5-8 matching targets |
| 3 | Verb Matcher | Step 2B | Auto on page load | Highlight 5-8 matching verbs |
| 4 | Mission Composer | Step 3 R1 | Auto on round start | Fill two template options |
| 5 | Sentence Refiner | Step 3 R2 | Button click | Refined complete sentence |
| 6 | Mission Analyst | Step 3 R3 | Button click | 4-criteria score + suggestions |
| 7 | Reflection Guide | Step 4 | Auto after submit | Personalized follow-up insights |

All AI roles use Groq `llama-3.3-70b-versatile` with fallback responses when API is unavailable.

---

## Files Deleted (4)

```
src/app/discover/mission/step5/page.tsx              — absorbed into Step 3
src/app/api/discover/mission/ai-roles/route.ts       — Life Roles AI removed
src/app/api/discover/mission/ai-questions/route.ts   — Wellbeing questions removed
src/app/api/discover/mission/ai-commitments/route.ts — R&C commitments removed
```

---

## Files Created (2)

```
src/app/api/discover/mission/ai-components/route.ts              — AI target/verb recommendations
database/migrations/2026-02-17-alter-mission-sessions-redesign.sql — Schema migration
```

---

## Files Modified (17)

### Frontend Pages (5)

| File | Change |
|------|--------|
| `src/app/discover/mission/page.tsx` | 4 steps, new labels, updated prerequisites |
| `src/app/discover/mission/step1/page.tsx` | Added top3 mission values selection + AI values insight |
| `src/app/discover/mission/step2/page.tsx` | **Full rewrite**: chip-selection grids for targets + verbs |
| `src/app/discover/mission/step3/page.tsx` | **Full rewrite**: 3-round mission drafting |
| `src/app/discover/mission/step4/page.tsx` | **Full rewrite**: reflection + completion flow |

### API Routes (4)

| File | Change |
|------|--------|
| `src/app/api/discover/mission/session/route.ts` | Step range 1-4; new fields (targets, verbs, rounds, reflections) |
| `src/app/api/discover/mission/ai-suggest/route.ts` | **Full rewrite**: 7 AI role prompts |
| `src/app/api/discover/mission/ai-components/route.ts` | **New**: target/verb AI recommendations |
| `src/app/api/discover/mission/context/route.ts` | Added life-themes data; removed life_roles refs |

### Types & Services (2)

| File | Change |
|------|--------|
| `src/lib/types/modules.ts` | MissionData interface rewritten; stages updated; estimatedMinutes 35 |
| `src/lib/services/moduleProgressService.ts` | getMissionData reads from `mission_sessions`; deriveProgress ÷4 |

### Other (1)

| File | Change |
|------|--------|
| `src/app/discover/values/[set]/page.tsx` | (from v3.4.2 merge) |

---

## Database Migration

```sql
-- Drop legacy Life Roles columns
ALTER TABLE mission_sessions DROP COLUMN IF EXISTS life_roles;
ALTER TABLE mission_sessions DROP COLUMN IF EXISTS wellbeing_reflections;
ALTER TABLE mission_sessions DROP COLUMN IF EXISTS role_commitments;
ALTER TABLE mission_sessions DROP COLUMN IF EXISTS wellbeing_commitments;

-- Add new mission component columns
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS top3_mission_values jsonb DEFAULT '[]';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS selected_targets jsonb DEFAULT '[]';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS selected_verbs jsonb DEFAULT '[]';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS custom_targets jsonb DEFAULT '[]';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS custom_verbs jsonb DEFAULT '[]';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS round1_data jsonb DEFAULT '{}';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS round2_data jsonb DEFAULT '{}';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS round3_data jsonb DEFAULT '{}';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS reflections jsonb DEFAULT '{}';
ALTER TABLE mission_sessions ADD COLUMN IF NOT EXISTS ai_insights jsonb DEFAULT '{}';

-- Step constraint 1-5 → 1-4
ALTER TABLE mission_sessions DROP CONSTRAINT IF EXISTS mission_sessions_current_step_check;
ALTER TABLE mission_sessions ADD CONSTRAINT mission_sessions_current_step_check
  CHECK (current_step BETWEEN 1 AND 4);
```

**Status**: Migration file created. Run in Supabase SQL Editor before testing.

---

## Updated MissionData Interface

```typescript
export interface MissionData {
  valuesUsed: Array<{
    type: 'terminal' | 'instrumental' | 'work';
    name: string;
    relevance: string;
    selected: boolean;
  }>;
  top3MissionValues: string[];
  aiValuesInsight?: string;
  selectedTargets: string[];
  selectedVerbs: string[];
  customTargets?: string[];
  customVerbs?: string[];
  round1: { selectedOption: 'option1' | 'option2' | 'freewrite'; text: string; };
  round2: { text: string; aiSuggestion?: string; };
  round3: { text: string; selfAssessment: { clear: boolean; inspiring: boolean; altruistic: boolean; concise: boolean; }; };
  reflections: { inspiration: string; alignment: string; feedback: string; };
  finalStatement: string;
  draftVersions: Array<{ version: number; text: string; createdAt: string; source: string; }>;
  completedAt?: string;
}
```

---

## Verification

- `npm run build` — 0 errors, 148 pages generated
- `grep life_roles src/app/discover/mission/` — 0 matches
- `grep step5 src/app/discover/mission/` — 0 matches
- `grep ai-roles|ai-questions|ai-commitments src/app/discover/mission/` — 0 matches
- Health check: `{"status":"healthy","database":"connected"}`

---

## Next Release

v3.5.1 — TDD test coverage for Mission module
